(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     79106,       2017]
NotebookOptionsPosition[     70354,       1914]
NotebookOutlinePosition[     70788,       1931]
CellTagsIndexPosition[     70745,       1928]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData["Exit"], "Input",
 CellChangeTimes->{{3.883312109531262*^9, 3.8833121100160503`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"d18aecdd-81bd-4349-83a0-f7189101b864"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Needs", "[", "\"\<PM`\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadPackages", "[", 
   RowBox[{"{", 
    RowBox[{"\"\<Geometries\>\"", ",", "\"\<RepulsorLink\>\""}], "}"}], "]"}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.882941662517531*^9, 3.882941663026194*^9}, 
   3.882987071311512*^9, {3.883052590011208*^9, 3.883052595109742*^9}, 
   3.8832939874858627`*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"586513da-5b14-4534-8da5-787999cc3862"],

Cell[BoxData[{
 RowBox[{"M", "=", 
  RowBox[{"TorusMesh", "[", 
   RowBox[{"3", ",", "1", ",", 
    RowBox[{"Mesh", "->", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"30", ",", "10"}], "}"}], " ", "2", " ", "2", " ", "2", " ", 
      "2", " ", "2"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportToFile", "[", 
    RowBox[{"M", ",", "\[IndentingNewLine]", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ParentDirectory", "[", 
         RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ",", 
        "\"\<Meshes\>\"", ",", 
        RowBox[{"\"\<TorusMesh_\>\"", "<>", 
         RowBox[{"IntegerString", "[", 
          RowBox[{
           RowBox[{"TriangleCount", "[", "M", "]"}], ",", "10", ",", "8"}], 
          "]"}], "<>", "\"\<T.txt\>\""}]}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "//", "AbsoluteTiming"}]}], "Input",
 CellChangeTimes->{{3.8832939890078897`*^9, 3.883294002989887*^9}, {
   3.8833121589649553`*^9, 3.883312162101326*^9}, 3.8833122447432737`*^9, {
   3.883312371262698*^9, 3.8833124038013067`*^9}, {3.8833124555509033`*^9, 
   3.8833124633385067`*^9}, {3.883312816883235*^9, 3.883312825161673*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"8ad1c0ba-b02f-4aa8-9234-d4e7e73a665c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2", ",", "x3"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NN", "=", 
   RowBox[{"{", 
    RowBox[{"\[Nu]1", ",", "\[Nu]2", ",", "\[Nu]3"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Y", "=", 
   RowBox[{"{", 
    RowBox[{"y1", ",", "y2", ",", "y3"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"W", "=", 
    RowBox[{"{", 
     RowBox[{"w1", ",", "w2", ",", "w3"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "\[CapitalPhi]", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r", "=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"Dot", "[", 
     RowBox[{
      RowBox[{"Y", "-", "X"}], ",", 
      RowBox[{"Y", "-", "X"}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalPhi]", "=", 
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"I", " ", "\[Kappa]", " ", "r"}], "]"}], "/", "r"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ker", "=", 
   RowBox[{
    RowBox[{"Refine", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{"\[CapitalPhi]", ",", 
           RowBox[{"{", 
            RowBox[{"X", ",", "1"}], "}"}]}], "]"}], ".", "NN"}], "-", 
        RowBox[{"I", " ", 
         RowBox[{"\[Kappa]", "/", "2"}], " ", "\[CapitalPhi]"}]}], "/.", 
       RowBox[{
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"Y", "-", "X"}], ",", 
          RowBox[{"Y", "-", "X"}]}], "]"}], "->", 
        RowBox[{"R", "^", "2"}]}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"R", ">", "0"}]}], "\[IndentingNewLine]", "]"}], "/.", 
    RowBox[{"Thread", "[", 
     RowBox[{"Y", "->", 
      RowBox[{"X", "+", "W"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ker", "=", 
  RowBox[{
   RowBox[{"Simplify", "[", 
    RowBox[{"Together", "[", 
     RowBox[{"ker", "/.", 
      RowBox[{"Thread", "[", 
       RowBox[{"Y", "->", 
        RowBox[{"X", "+", "W"}]}], "]"}]}], "]"}], "]"}], "/.", " ", 
   RowBox[{
    RowBox[{"NN", ".", "W"}], "->", "\[Nu]w"}]}]}]}], "Input",
 CellChangeTimes->{{3.8829710759622107`*^9, 3.88297111869421*^9}, {
  3.882971172432406*^9, 3.882971173973262*^9}, {3.882971780922842*^9, 
  3.8829717998148117`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"b1b61abe-9f95-4822-aca6-4adaaa0aa621"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "cf", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"cf", "[", "nrhs_", "]"}], ":=", 
    RowBox[{
     RowBox[{"cf", "[", "nrhs", "]"}], "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Nu]", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"v", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Kappa]", ",", "_Real"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"ibegin", ",", "_Integer"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"iend", ",", "_Integer"}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "m", ",", "n", ",", "u", ",", "sum", ",", "x1", ",", "x2", ",", 
           "x3", ",", "\[Nu]1", ",", "\[Nu]2", ",", "\[Nu]3", ",", "w1", ",", 
           "w2", ",", "w3", ",", "R", ",", "R2", ",", "R3", ",", "\[Nu]w", 
           ",", "ai", ",", "aj", ",", "factor"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"n", "=", 
           RowBox[{"Length", "[", "v", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"u", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"0.", "+", 
              RowBox[{"0.", "I"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"iend", "-", "ibegin", "+", "1"}], "}"}], ",", 
             RowBox[{"{", "nrhs", "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"sum", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"0.", "+", 
              RowBox[{"0.", "I"}]}], ",", 
             RowBox[{"{", "nrhs", "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"x1", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"x", ",", "i", ",", "1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"x2", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"x", ",", "i", ",", "2"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"x3", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"x", ",", "i", ",", "3"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Nu]1", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"\[Nu]", ",", "i", ",", "1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Nu]2", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"\[Nu]", ",", "i", ",", "2"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Nu]3", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"\[Nu]", ",", "i", ",", "3"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"sum", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], "=", 
                RowBox[{"0.", "+", 
                 RowBox[{"0.", "I"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", "nrhs"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"i", "!=", "j"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"w1", "=", 
                    RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "1"}], "]"}], "-", "x1"}]}], 
                   ";", "\[IndentingNewLine]", 
                   RowBox[{"w2", "=", 
                    RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "2"}], "]"}], "-", "x2"}]}], 
                   ";", "\[IndentingNewLine]", 
                   RowBox[{"w3", "=", 
                    RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "3"}], "]"}], "-", "x3"}]}], 
                   ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   RowBox[{"R2", "=", 
                    RowBox[{
                    RowBox[{"w1", " ", "w1"}], "+", 
                    RowBox[{"w2", " ", "w2"}], "+", 
                    RowBox[{"w3", " ", "w3"}]}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"R", "=", 
                    RowBox[{"Sqrt", "[", "R2", "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"R3", "=", 
                    RowBox[{"R", " ", "R2"}]}], ";", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{"\[Nu]w", "=", 
                    RowBox[{
                    RowBox[{"\[Nu]1", " ", "w1"}], "+", 
                    RowBox[{"\[Nu]2", " ", "w2"}], "+", 
                    RowBox[{"\[Nu]3", " ", "w3"}]}]}], ";", 
                   "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   RowBox[{"factor", "=", 
                    RowBox[{"-", 
                    FractionBox[
                    RowBox[{" ", 
                    RowBox[{
                    SuperscriptBox["\[ExponentialE]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1.", "I"}], ")"}], " ", "R", " ", "\[Kappa]"}]], 
                    " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"0.5", "I"}], ")"}], "R2", " ", "\[Kappa]"}], "-",
                     " ", "\[Nu]w", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1.", "I"}], ")"}], " ", "R", " ", "\[Kappa]", 
                    " ", "\[Nu]w"}]}], ")"}]}]}], 
                    RowBox[{" ", "R3"}]]}]}], ";", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{"Do", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"sum", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], "+=", 
                    RowBox[{"factor", " ", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"v", ",", "j", ",", "k"}], "]"}]}]}], ";"}], ",", 
                    
                    RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", "nrhs"}], "}"}]}], "]"}]}]}], 
                 "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
               ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "n"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"u", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "-", "ibegin", "+", "1"}], ",", "k"}], "]"}], 
                 "]"}], "=", 
                RowBox[{"sum", "[", 
                 RowBox[{"[", "k", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", "nrhs"}], "}"}]}], "]"}], ";"}], 
            "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "ibegin", ",", "iend"}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "u"}]}], "\[IndentingNewLine]", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"RuntimeAttributes", "->", 
        RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Parallelization", "->", "True"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}]}], 
      "\[IndentingNewLine]", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "cMatrix", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cMatrix", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Nu]", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Kappa]", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ibegin", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"iend", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"jbegin", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"jend", ",", "_Integer"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n", ",", "u", ",", "x1", ",", "x2", ",", "x3", ",", "\[Nu]1", ",", 
         "\[Nu]2", ",", "\[Nu]3", ",", "w1", ",", "w2", ",", "w3", ",", "R", 
         ",", "R2", ",", "R3", ",", "\[Nu]w", ",", "ai", ",", "aj", ",", 
         "factor", ",", "A"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"A", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"0.", "+", 
            RowBox[{"0.", "I"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"iend", "-", "ibegin", "+", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"jend", "-", "jbegin"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"x1", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"x", ",", "i", ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x2", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"x", ",", "i", ",", "2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x3", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"x", ",", "i", ",", "3"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"\[Nu]1", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"\[Nu]", ",", "i", ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"\[Nu]2", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"\[Nu]", ",", "i", ",", "2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"\[Nu]3", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"\[Nu]", ",", "i", ",", "3"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"i", "!=", "j"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"w1", "=", 
                  RowBox[{
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "1"}], "]"}], "-", "x1"}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"w2", "=", 
                  RowBox[{
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "2"}], "]"}], "-", "x2"}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"w3", "=", 
                  RowBox[{
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "3"}], "]"}], "-", "x3"}]}], 
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"R2", "=", 
                  RowBox[{
                   RowBox[{"w1", " ", "w1"}], "+", 
                   RowBox[{"w2", " ", "w2"}], "+", 
                   RowBox[{"w3", " ", "w3"}]}]}], ";", "\[IndentingNewLine]", 
                 
                 RowBox[{"R", "=", 
                  RowBox[{"Sqrt", "[", "R2", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"R3", "=", 
                  RowBox[{"R", " ", "R2"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"\[Nu]w", "=", 
                  RowBox[{
                   RowBox[{"\[Nu]1", " ", "w1"}], "+", 
                   RowBox[{"\[Nu]2", " ", "w2"}], "+", 
                   RowBox[{"\[Nu]3", " ", "w3"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"A", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "ibegin", "+", "1"}], ",", 
                    RowBox[{"j", "-", "jbegin", "+", "1"}]}], "]"}], "]"}], 
                  "=", 
                  RowBox[{"-", 
                   FractionBox[
                    RowBox[{" ", 
                    RowBox[{
                    SuperscriptBox["\[ExponentialE]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1.", "I"}], ")"}], " ", "R", " ", "\[Kappa]"}]], 
                    " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"0.5", "I"}], ")"}], "R2", " ", "\[Kappa]"}], "-",
                     " ", "\[Nu]w", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1.", "I"}], ")"}], " ", "R", " ", "\[Kappa]", 
                    " ", "\[Nu]w"}]}], ")"}]}]}], 
                    RowBox[{" ", "R3"}]]}]}], ";"}]}], "\[IndentingNewLine]", 
               "]"}], ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "jbegin", ",", "jend"}], "}"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ibegin", ",", "iend"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "A"}]}], "\[IndentingNewLine]", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"RuntimeAttributes", "->", 
      RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"Parallelization", "->", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.882970772063243*^9, 3.882970898861167*^9}, {
   3.882971432108029*^9, 3.8829715581500998`*^9}, {3.8829718331230507`*^9, 
   3.882972017675655*^9}, {3.88297216651108*^9, 3.882972174026658*^9}, {
   3.8829722107916613`*^9, 3.882972217367504*^9}, 3.8829722754404507`*^9, 
   3.882972372808489*^9, {3.8829845235857153`*^9, 3.882984625471059*^9}, {
   3.882984700154338*^9, 3.8829847132697163`*^9}, {3.882984755377787*^9, 
   3.882984769201005*^9}, {3.8829848931574183`*^9, 3.882985123476408*^9}, {
   3.88298516917581*^9, 3.8829851898973713`*^9}, {3.882985879385192*^9, 
   3.8829859360945587`*^9}, {3.882985996829647*^9, 3.882985999364751*^9}, {
   3.882986790370079*^9, 3.8829868479739103`*^9}, {3.882986899690175*^9, 
   3.8829869097842216`*^9}, {3.883052494860084*^9, 3.883052535313271*^9}},
 CellLabel->"In[26]:=",ExpressionUUID->"65f2fcd9-a55f-422f-83e6-20a36b43e3f6"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.883052571432144*^9, 
  3.883052621278954*^9}},ExpressionUUID->"e92b20b5-2d4e-4af3-8683-\
9503f046b4b6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"M", "=", 
   RowBox[{"TorusMesh", "[", 
    RowBox[{"3", ",", "1", ",", 
     RowBox[{"Mesh", "->", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"30", ",", "10"}], "}"}], "2", " ", "2", " ", "2"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Av", "=", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"TriangleAreas", "[", "M", "]"}], "/", "3"}], ")"}], "]"}], 
    RowBox[{"AdjacencyMatrix", "[", 
     RowBox[{"M", ",", "Triangles", ",", "Vertices"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"B", "=", 
  RowBox[{
   RowBox[{"BlockClusterMatrices", "[", 
    RowBox[{"Repulsor", "[", "M", "]"}], "]"}], "[", "\"\<Far\>\"", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AvT", "=", 
   RowBox[{"Transpose", "[", "Av", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.882972061912818*^9, 3.8829720774176064`*^9}, {
   3.882972423288622*^9, 3.882972452285796*^9}, {3.882972498255321*^9, 
   3.88297249843157*^9}, {3.882985270953065*^9, 3.882985271102271*^9}, {
   3.8829853043930063`*^9, 3.8829853045949507`*^9}, {3.882985363832755*^9, 
   3.882985397816867*^9}, {3.882986960107437*^9, 3.882986960222568*^9}, 
   3.883052623621208*^9},ExpressionUUID->"2015d288-eb3f-4514-ade6-\
85d44128e3c6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetRandomVectorSmoothingParameter", "[", 
   RowBox[{"M", ",", "10."}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nrhs", "=", 
   RowBox[{"3", " ", "d"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"v", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Sequence", "@@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"SmoothedRandomVector", "[", "M", "]"}], ",", 
        RowBox[{"{", "d", "}"}]}], "]"}]}], ",", "2"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"V", "=", 
   RowBox[{"Av", ".", "v"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"n", "=", 
    RowBox[{"TriangleCount", "[", "M", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"begin", "=", 
   RowBox[{
    RowBox[{"Most", "[", 
     RowBox[{"JobPointers", "[", 
      RowBox[{"n", ",", "8"}], "]"}], "]"}], "+", "1"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"end", "=", 
   RowBox[{"Rest", "[", 
    RowBox[{"JobPointers", "[", 
     RowBox[{"n", ",", "8"}], "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"V", "=", 
    RowBox[{"Av", ".", "v"}]}], ";"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"U", "=", 
    RowBox[{"Join", "@@", 
     RowBox[{
      RowBox[{"cf", "[", 
       RowBox[{
        RowBox[{"Dimensions", "[", "V", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "]"}], "[", 
      RowBox[{
       RowBox[{"TriangleMidpoints", "[", "M", "]"}], ",", 
       RowBox[{"TriangleNormals", "[", "M", "]"}], ",", "V", ",", "2.", ",", 
       "begin", ",", "end"}], "]"}]}]}], ";"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"u", "=", 
    RowBox[{"AvT", ".", "U"}]}], ";"}], "//", "AbsoluteTiming"}]}], "Input",
 CellChangeTimes->{{3.8829720308752317`*^9, 3.882972060993639*^9}, {
  3.8829724599897842`*^9, 3.8829724731957073`*^9}, {3.882972542322772*^9, 
  3.882972603091206*^9}, {3.8829846418755083`*^9, 3.8829846422561693`*^9}, {
  3.8829846768352757`*^9, 3.88298469140451*^9}, {3.882984739430481*^9, 
  3.8829847793107777`*^9}, {3.8829848145502377`*^9, 3.882984853564724*^9}, {
  3.882985198059409*^9, 3.882985223858079*^9}, {3.882985368773642*^9, 
  3.8829856240570517`*^9}, {3.882985950240456*^9, 3.8829859695426617`*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"b3045e1b-d1dc-4d10-8956-42da191eeb8d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"n", "=", "40000"}], ";"}]], "Input",
 CellChangeTimes->{{3.882987163532997*^9, 3.8829871654954443`*^9}, {
  3.8829872102966433`*^9, 3.882987210737193*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"c2b91be5-d559-43c9-b8a3-5b5b0a79ee12"],

Cell[BoxData[
 RowBox[{"UnitConvert", "[", 
  RowBox[{
   RowBox[{"Quantity", "[", 
    RowBox[{
     RowBox[{"n", " ", "n", " ", "128."}], ",", "\"\<Bits\>\""}], "]"}], ",", 
   "\"\<Gigabytes\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.882987094499148*^9, 3.882987141138402*^9}, {
  3.88298717464188*^9, 3.88298720368827*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"7d1214ae-f644-42be-a28b-027072396081"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"A", "=", 
     RowBox[{"Join", "@@", 
      RowBox[{"cMatrix", "[", 
       RowBox[{
        RowBox[{"TriangleMidpoints", "[", "M", "]"}], ",", 
        RowBox[{"TriangleNormals", "[", "M", "]"}], ",", "2.", ",", "begin", 
        ",", "end"}], "]"}]}]}], ";"}], "//", "AbsoluteTiming"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.882986862642317*^9, 3.8829868668227386`*^9}, {
  3.882986915310852*^9, 3.8829869233006487`*^9}, {3.8829870601762466`*^9, 
  3.882987064814294*^9}},ExpressionUUID->"888592c0-4315-4aa3-9965-\
57749449b336"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A", ".", "V"}], ";"}], "//", "AbsoluteTiming"}]], "Input",Expressi\
onUUID->"341876ec-4665-4428-90f7-12b362c97e00"],

Cell[BoxData[
 RowBox[{"Max", "[", 
  RowBox[{"Abs", "[", 
   RowBox[{
    RowBox[{"A", ".", "V"}], "-", "U"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.882986944967441*^9, 3.8829869486313334`*^9}},
 CellLabel->
  "In[984]:=",ExpressionUUID->"e87525e6-6bfa-4af7-8c66-49e3c82cb9d6"],

Cell[BoxData[
 RowBox[{"A", "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.8829869530837*^9, 3.882986955597705*^9}},
 CellLabel->
  "In[985]:=",ExpressionUUID->"732ca52d-b8cc-421d-8f33-b8853a77d30f"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.882986925667038*^9, 3.882986931450439*^9}, 
   3.882986968351111*^9},ExpressionUUID->"aac9108b-9491-46e5-89bb-\
84139eddd052"],

Cell[BoxData[
 RowBox[{"CP", "@", "cMatrix"}]], "Input",
 CellChangeTimes->{{3.882986872460753*^9, 3.882986875200945*^9}},
 CellLabel->
  "In[964]:=",ExpressionUUID->"02c3f2e2-054f-4a2c-bc16-7d1c2523bca0"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "U", "]"}]], "Input",
 CellChangeTimes->{{3.882985851539743*^9, 3.8829858535340757`*^9}},
 CellLabel->
  "In[916]:=",ExpressionUUID->"c3fefd57-557b-4d97-94b9-9c9b54d85897"],

Cell[BoxData[
 RowBox[{"v", "//", "PackedQ"}]], "Input",
 CellChangeTimes->{{3.882985498584797*^9, 3.882985500909409*^9}},
 CellLabel->
  "In[570]:=",ExpressionUUID->"4bc9b89d-09ae-4910-83de-63f4328196b1"],

Cell[BoxData[
 RowBox[{"//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.882985463823619*^9, 
  3.88298548879742*^9}},ExpressionUUID->"8cf373c7-eda1-4f46-a020-\
e0029f896c99"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Av", ".", "v"}], "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.8829854314942207`*^9, 3.882985432613648*^9}},
 CellLabel->
  "In[544]:=",ExpressionUUID->"93b39c72-5cbc-4d0f-8ba2-5f8dacf10eee"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8829853490054493`*^9, 
  3.88298536227606*^9}},ExpressionUUID->"e4f9882f-020c-4bcf-8c3d-\
010174551656"],

Cell[BoxData["n"], "Input",
 CellChangeTimes->{3.882985287272394*^9},
 CellLabel->
  "In[513]:=",ExpressionUUID->"297e29b2-b67d-4e92-8acc-4520a42de636"],

Cell[BoxData[
 RowBox[{"CP", "@", 
  RowBox[{"cf", "[", 
   RowBox[{
    RowBox[{"Dimensions", "[", "V", "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.882984976851295*^9, 3.8829849782620697`*^9}},
 CellLabel->
  "In[365]:=",ExpressionUUID->"26ef3ba0-aec7-4e60-b032-b4689edb97f7"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "u", "]"}]], "Input",
 CellChangeTimes->{{3.882984829765847*^9, 3.882984831109614*^9}},
 CellLabel->
  "In[300]:=",ExpressionUUID->"4b738fbb-7b19-42f7-86fb-fc020b9463c0"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.882984729757518*^9, 
  3.882984737876951*^9}},ExpressionUUID->"fbdc1b07-7ecd-4a1a-a491-\
909f727072dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"bla", "=", 
    RowBox[{
     RowBox[{"cf", "[", "3", "]"}], "[", 
     RowBox[{
      RowBox[{"TriangleAreas", "[", "M", "]"}], ",", 
      RowBox[{"TriangleMidpoints", "[", "M", "]"}], ",", 
      RowBox[{"TriangleNormals", "[", "M", "]"}], ",", "V", ",", "2.", ",", 
      "begin", ",", "end"}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.882984799721171*^9, 3.882984802298567*^9}},
 CellLabel->
  "In[258]:=",ExpressionUUID->"7969a3fe-5b6a-4414-ad40-28a4d98cdc3b"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{
  3.882984637720272*^9},ExpressionUUID->"a3f08e1b-9962-4110-88e3-\
9ce434b49460"],

Cell[BoxData[
 RowBox[{"2.981859`", "/", "8"}]], "Input",
 CellChangeTimes->{{3.882984791717811*^9, 3.882984792358045*^9}},
 CellLabel->
  "In[257]:=",ExpressionUUID->"2e0806c1-7b76-4ed4-9a3e-a2c05c8cc48e"],

Cell[BoxData["M"], "Input",
 CellChangeTimes->{{3.8829839850175867`*^9, 3.8829839857595673`*^9}},
 CellLabel->
  "In[195]:=",ExpressionUUID->"5742787d-f79c-4bd1-bd36-bd24b31493d9"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8829723579573727`*^9, 3.882972395867629*^9}, 
   3.882984683625311*^9},ExpressionUUID->"ce545b33-a26c-45db-8245-\
230aa6f2f510"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{
    RowBox[{"ColorGradient", "[", 
     RowBox[{"M", ",", "v"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"MeshPlot", "[", "M", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ColorGradient", "[", 
     RowBox[{"M", ",", 
      RowBox[{"Re", "[", "u", "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"MeshPlot", "[", "M", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8829724088458347`*^9, 3.8829724172239532`*^9}, {
   3.8829724846534243`*^9, 3.882972488982095*^9}, {3.882972529464883*^9, 
   3.882972532520399*^9}, {3.882972604342568*^9, 3.882972617078829*^9}, 
   3.88298468727778*^9},ExpressionUUID->"6b446738-454b-41ac-9bbb-\
881d3d378c75"],

Cell[BoxData[
 RowBox[{"FieldPlot", "[", 
  RowBox[{"M", ",", 
   RowBox[{"Re", "[", "u", "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.882972346062698*^9, 3.882972350862824*^9}},
 CellLabel->
  "In[129]:=",ExpressionUUID->"aed34bea-99fc-4ac7-919e-3f7cf9ca8cd4"],

Cell[BoxData[
 RowBox[{"u", "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.882972399579393*^9, 3.882972400791252*^9}},
 CellLabel->
  "In[130]:=",ExpressionUUID->"eeaf195d-57e0-4a63-8765-918bc7f81e1b"],

Cell[BoxData["M"], "Input",
 CellChangeTimes->{3.882972402130501*^9},
 CellLabel->
  "In[131]:=",ExpressionUUID->"048b9279-6a7a-4c54-8bc3-c258fbd05a38"],

Cell[BoxData[
 RowBox[{"V", "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.8829722890887613`*^9, 3.882972290439653*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"dd7c7267-a52a-4f00-a9b4-83f72bc13109"],

Cell[BoxData[
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Indexed", "[", 
      RowBox[{"x", ",", "i"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
  "\[IndentingNewLine]", 
  RowBox[{"Y", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Indexed", "[", 
      RowBox[{"y", ",", "i"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
  "\[IndentingNewLine]", 
  RowBox[{"Z", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Indexed", "[", 
      RowBox[{"z", ",", "i"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"mynorm", "[", "x_", "]"}], "=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"X", ".", "X"}], "]"}]}], ";", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"R", "[", 
    RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"mynorm", "[", 
     RowBox[{"Z", "-", "X"}], "]"}], 
    RowBox[{"mynorm", "[", 
     RowBox[{"X", "-", "Y"}], "]"}], 
    RowBox[{
     RowBox[{
      RowBox[{"mynorm", "[", 
       RowBox[{"Y", "-", "Z"}], "]"}], "/", 
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"Z", "-", "X"}], ",", 
        RowBox[{"Y", "-", "X"}]}], "]"}]}], "/", "2"}]}]}], ";", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"\[CapitalPsi]", "[", 
    RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"2", "r", " ", 
     RowBox[{"Cross", "[", 
      RowBox[{
       RowBox[{"Z", "-", "X"}], ",", 
       RowBox[{"Y", "-", "X"}]}], "]"}]}], "-", 
    RowBox[{
     RowBox[{"mynorm", "[", 
      RowBox[{"Z", "-", "X"}], "]"}], 
     RowBox[{"mynorm", "[", 
      RowBox[{"X", "-", "Y"}], "]"}], 
     RowBox[{"mynorm", "[", 
      RowBox[{"Y", "-", "Z"}], "]"}]}]}]}], ";"}]], "Input",
 CellLabel->"In[48]:=",ExpressionUUID->"a5429363-d065-4be8-a815-da14298c6eb9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[CapitalPhi]", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], "=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"I", " ", "\[Kappa]", " ", 
     RowBox[{"mynorm", "[", 
      RowBox[{"Y", "-", "X"}], "]"}]}], "]"}], "/", 
   RowBox[{"mynorm", "[", 
    RowBox[{"Y", "-", "X"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.88296742187003*^9, 3.882967450476782*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"4a141a1b-4e17-4ee3-a482-30be2ed09dce"],

Cell[BoxData[
 RowBox[{"Simplify", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"mynorm", "[", 
      RowBox[{"Y", "-", "X"}], "]"}], 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{
        RowBox[{"\[CapitalPhi]", "[", 
         RowBox[{"X", ",", "Y"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"X", ",", "1"}], "}"}]}], "]"}], ".", "NN"}]}], "/.", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", 
          TemplateBox[{"x", "1"},
           "IndexedDefault"]}], "+", 
         TemplateBox[{"y", "1"},
          "IndexedDefault"]}], ")"}], "2"], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", 
          TemplateBox[{"x", "2"},
           "IndexedDefault"]}], "+", 
         TemplateBox[{"y", "2"},
          "IndexedDefault"]}], ")"}], "2"], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", 
          TemplateBox[{"x", "3"},
           "IndexedDefault"]}], "+", 
         TemplateBox[{"y", "3"},
          "IndexedDefault"]}], ")"}], "2"]}], "->", 
     RowBox[{"r", "^", "2"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"r", ">", "0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.882969999856176*^9, 3.882970035507126*^9}, {
  3.882970083631962*^9, 3.8829701112441607`*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"12b88551-39f7-4c82-b083-0d131a33d8dc"],

Cell[BoxData[
 RowBox[{"NN", ".", 
  RowBox[{"(", 
   RowBox[{"Y", "-", "X"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.88297013721629*^9, 3.8829701438274393`*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"913cbdd3-a0c1-4001-a942-9eec51798f2e"],

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", 
      RowBox[{"Sin", "[", "\[Phi]", "]"}], ",", "0"}], "}"}], ".", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", 
        RowBox[{"Sin", "[", "\[Phi]", "]"}], ",", "0"}], "}"}], "-", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], ")"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Phi]", ",", "0", ",", "2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8829701796644573`*^9, 3.882970206944334*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"f465b36d-a39e-44eb-a249-a65f54a11a80"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.882970548845957*^9, 
  3.8829706688966293`*^9}},ExpressionUUID->"00c41a40-e3f9-48fd-90da-\
8113bd7fb8e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NN", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Indexed", "[", 
      RowBox[{"\[Nu]", ",", "i"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.882967531400845*^9, 3.882967549615205*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"ce0bd1d8-0d9c-4dde-8dfd-881556e5a12e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"f", "[", 
   RowBox[{"x_", ",", "\[Nu]_", ",", "y_", ",", "\[Kappa]_"}], "]"}], "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"\[CapitalPhi]", "[", 
        RowBox[{"X", ",", "Y"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"X", ",", "1"}], "}"}]}], "]"}], ".", "NN"}], "-", 
    RowBox[{"I", " ", 
     RowBox[{"\[Kappa]", "/", "2"}], " ", 
     RowBox[{"\[CapitalPhi]", "[", 
      RowBox[{"X", ",", "Y"}], "]"}]}]}], "//", 
   "Together"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"F", "[", 
   RowBox[{"x_", ",", "\[Nu]_", ",", "y_", ",", "\[Kappa]_"}], "]"}], "=", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"X", ",", "NN", ",", "Y", ",", "\[Kappa]"}], "]"}], 
    RowBox[{"mynorm", "[", 
     RowBox[{"Y", "-", "X"}], "]"}]}], "//", "Together"}]}]}], "Input",
 CellChangeTimes->{{3.882967460550668*^9, 3.882967519640561*^9}, {
   3.882967554024942*^9, 3.8829675548632917`*^9}, {3.882967614684553*^9, 
   3.88296761517455*^9}, {3.882967753993209*^9, 3.8829677731235857`*^9}, {
   3.882968072184722*^9, 3.882968092205748*^9}, 3.882971143375312*^9},
 CellLabel->"In[49]:=",ExpressionUUID->"13775838-fd37-4db5-9e68-fecbcfb5322d"],

Cell[BoxData[
 RowBox[{"X", "=."}]], "Input",
 CellChangeTimes->{{3.88296809645078*^9, 3.882968100092964*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"71aa9f40-2fe7-4098-8207-0c1e6a310273"],

Cell[BoxData[
 RowBox[{"bla", "=", 
  RowBox[{
   RowBox[{"F", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", 
       RowBox[{"Sin", "[", "\[Phi]", "]"}], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", 
       RowBox[{"Sin", "[", "\[Phi]", "]"}], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", "\[Kappa]"}], "]"}], "//",
    "Simplify"}]}]], "Input",
 CellChangeTimes->{{3.882967830942644*^9, 3.882967862432157*^9}, 
   3.882968118515933*^9},
 CellLabel->"In[51]:=",ExpressionUUID->"8998f1ce-e3be-4e09-8d36-827b2f238999"],

Cell[BoxData[
 RowBox[{"blubb", "=", 
  RowBox[{"Normal", "@", 
   RowBox[{"Series", "[", 
    RowBox[{"bla", ",", 
     RowBox[{"{", 
      RowBox[{"\[Phi]", ",", "0", ",", "2"}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.882967893351006*^9, 3.8829679156233387`*^9}, {
  3.882967955623846*^9, 3.882967964667283*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"df1aee22-db32-43f8-a1a6-8efc125284c8"],

Cell[BoxData["D"], "Input",
 CellChangeTimes->{
  3.882969964321413*^9},ExpressionUUID->"f432e111-7395-4735-b9e5-\
416a60d93b37"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Simplify", "[", 
   RowBox[{"blubb", ",", 
    RowBox[{"\[Phi]", "<", "0"}]}], "]"}], "//", "Expand"}]], "Input",
 CellChangeTimes->{{3.88296801972339*^9, 3.882968053830598*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"0ea92abd-3d5d-4a8b-9cc7-705e87dcadf7"],

Cell[BoxData[{
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Re", "[", "bla", "]"}], ",", 
     RowBox[{"Re", "[", "blubb", "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Phi]", ",", 
     RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Im", "[", "bla", "]"}], ",", 
     RowBox[{"Im", "[", "blubb", "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Phi]", ",", 
     RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.882967870308757*^9, 3.882967876474482*^9}, {
  3.8829679666278687`*^9, 3.882967989598035*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"d11a9db6-0530-4b1f-80d4-48d56cfc2f40"],

Cell[BoxData[
 RowBox[{"Simplify", "[", 
  RowBox[{
   RowBox[{"bla", "/.", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", 
          TemplateBox[{"x", "1"},
           "IndexedDefault"]}], "+", 
         TemplateBox[{"y", "1"},
          "IndexedDefault"]}], ")"}], "2"], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", 
          TemplateBox[{"x", "2"},
           "IndexedDefault"]}], "+", 
         TemplateBox[{"y", "2"},
          "IndexedDefault"]}], ")"}], "2"], "+", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", 
          TemplateBox[{"x", "3"},
           "IndexedDefault"]}], "+", 
         TemplateBox[{"y", "3"},
          "IndexedDefault"]}], ")"}], "2"]}], "->", 
     RowBox[{"r", "^", "2"}]}]}], ",", 
   RowBox[{"r", ">", "0"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.882967615872428*^9, 3.88296764144256*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"17a534f9-d0eb-4dac-88d4-47d6503d0f5c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"\[Kappa]", " ", 
     SuperscriptBox[
      TemplateBox[{"x", "1"},
       "IndexedDefault"], "2"]}], "+", 
    RowBox[{"\[Kappa]", " ", 
     SuperscriptBox[
      TemplateBox[{"x", "2"},
       "IndexedDefault"], "2"]}], "+", 
    RowBox[{"\[Kappa]", " ", 
     SuperscriptBox[
      TemplateBox[{"x", "3"},
       "IndexedDefault"], "2"]}], "+", 
    RowBox[{"\[Kappa]", " ", 
     SuperscriptBox[
      TemplateBox[{"y", "1"},
       "IndexedDefault"], "2"]}], "+", 
    RowBox[{"\[Kappa]", " ", 
     SuperscriptBox[
      TemplateBox[{"y", "2"},
       "IndexedDefault"], "2"]}], "-", 
    RowBox[{"2", " ", "\[Kappa]", " ", 
     TemplateBox[{"x", "3"},
      "IndexedDefault"], " ", 
     TemplateBox[{"y", "3"},
      "IndexedDefault"]}], "+", 
    RowBox[{"\[Kappa]", " ", 
     SuperscriptBox[
      TemplateBox[{"y", "3"},
       "IndexedDefault"], "2"]}], "+", 
    RowBox[{"2", " ", "\[ImaginaryI]", " ", 
     TemplateBox[{"y", "1"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "1"},
      "IndexedDefault"]}], "+", 
    RowBox[{"2", " ", "r", " ", "\[Kappa]", " ", 
     TemplateBox[{"y", "1"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "1"},
      "IndexedDefault"]}], "-", 
    RowBox[{"2", " ", 
     TemplateBox[{"x", "1"},
      "IndexedDefault"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"\[Kappa]", " ", 
        TemplateBox[{"y", "1"},
         "IndexedDefault"]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[ImaginaryI]", "+", 
          RowBox[{"r", " ", "\[Kappa]"}]}], ")"}], " ", 
        TemplateBox[{"\[Nu]", "1"},
         "IndexedDefault"]}]}], ")"}]}], "+", 
    RowBox[{"2", " ", "\[ImaginaryI]", " ", 
     TemplateBox[{"y", "2"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "2"},
      "IndexedDefault"]}], "+", 
    RowBox[{"2", " ", "r", " ", "\[Kappa]", " ", 
     TemplateBox[{"y", "2"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "2"},
      "IndexedDefault"]}], "-", 
    RowBox[{"2", " ", 
     TemplateBox[{"x", "2"},
      "IndexedDefault"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"\[Kappa]", " ", 
        TemplateBox[{"y", "2"},
         "IndexedDefault"]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[ImaginaryI]", "+", 
          RowBox[{"r", " ", "\[Kappa]"}]}], ")"}], " ", 
        TemplateBox[{"\[Nu]", "2"},
         "IndexedDefault"]}]}], ")"}]}], "-", 
    RowBox[{"2", " ", "\[ImaginaryI]", " ", 
     TemplateBox[{"x", "3"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "3"},
      "IndexedDefault"]}], "-", 
    RowBox[{"2", " ", "r", " ", "\[Kappa]", " ", 
     TemplateBox[{"x", "3"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "3"},
      "IndexedDefault"]}], "+", 
    RowBox[{"2", " ", "\[ImaginaryI]", " ", 
     TemplateBox[{"y", "3"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "3"},
      "IndexedDefault"]}], "+", 
    RowBox[{"2", " ", "r", " ", "\[Kappa]", " ", 
     TemplateBox[{"y", "3"},
      "IndexedDefault"], " ", 
     TemplateBox[{"\[Nu]", "3"},
      "IndexedDefault"]}]}], ")"}], "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.882967677699046*^9, 3.8829676787014*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"8e1bef29-128d-49da-b465-7f108240a535"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Kappa]", "=", "2"}], ";"}]], "Input",
 CellChangeTimes->{{3.8829676925983458`*^9, 3.882967693640971*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"b7ad19dc-7c31-4be3-bc25-c220fda24938"],

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<PM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"LoadPackages", "[", "\"\<Geometries\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.882967714840824*^9, 3.8829677223903933`*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"c7db2593-02b6-47da-84ed-94b51c7b4788"],

Cell[BoxData[
 RowBox[{
  RowBox[{"M", "=", 
   RowBox[{"SphereMesh", "[", "5", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8829677053385*^9, 3.882967734223959*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"dc9ffd70-cd59-4e48-b87c-9d6ad383a893"],

Cell[BoxData[
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"TriangleMidpoints", "[", "M", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.882943339573946*^9, 3.882943339814234*^9}, {
  3.8829677844202967`*^9, 3.882967790508808*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"d4fd69ef-a6c4-4424-aaf5-3c7991932366"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mynorm", "[", 
    RowBox[{"Z", "-", "X"}], "]"}], 
   RowBox[{"mynorm", "[", 
    RowBox[{"X", "-", "Y"}], "]"}], 
   RowBox[{"mynorm", "[", 
    RowBox[{"Y", "-", "Z"}], "]"}]}], ">=", " ", 
  RowBox[{"2", "r", " ", 
   RowBox[{"Cross", "[", 
    RowBox[{
     RowBox[{"Z", "-", "X"}], ",", 
     RowBox[{"Y", "-", "X"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.882943255901416*^9, 
  3.882943266440813*^9}},ExpressionUUID->"d682aed4-5de6-4d86-9503-\
522979edb467"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.882943236088677*^9, 
  3.882943314130414*^9}},ExpressionUUID->"915affd5-6353-4c99-9310-\
107955f39b51"],

Cell[BoxData[
 RowBox[{"\[CapitalPsi]", "[", 
  RowBox[{"X", ",", "Y", ",", "Z"}], "]"}]], "Input",
 CellChangeTimes->{{3.882943306206678*^9, 
  3.882943308495985*^9}},ExpressionUUID->"a9ba5d8e-6c24-4af7-8c86-\
15ca2b1050a9"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.882943033914912*^9, 3.8829430401510477`*^9}, 
   3.8829431645177727`*^9},ExpressionUUID->"2d63c2c2-b95d-4629-88a8-\
9447b393f345"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Indexed", "[", 
      RowBox[{"x", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Y", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Indexed", "[", 
      RowBox[{"y", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.882941667150185*^9, 3.882941712180429*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"95ad01ee-89f8-4123-a61f-06e8bf19795c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"D\[Gamma]", "=", 
   RowBox[{
    RowBox[{"X", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "-", 
    RowBox[{"X", "[", 
     RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[CapitalDelta]\[Gamma]", "="}]}], "Input",
 CellChangeTimes->{{3.8829417163784323`*^9, 
  3.882941761561277*^9}},ExpressionUUID->"a505d88c-b129-4276-897f-\
45b1646ac738"],

Cell[BoxData[
 RowBox[{"Needs", "[", "\"\<PM`\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.882942617638647*^9, 3.8829426203783913`*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"28e530dc-140d-4b2e-859d-edaf4605de2b"],

Cell[BoxData[
 RowBox[{"LoadPackages", "[", "\"\<Geometries\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.882942621397203*^9, 3.882942624820978*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"42d6c0a0-36ca-45e0-a4e8-64b3edc1e9a3"],

Cell[BoxData[
 RowBox[{"OpenSource", "@", "TriangleCircumcircleRadii"}]], "Input",
 CellChangeTimes->{{3.8829426258107357`*^9, 3.882942635270093*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"7225198b-1689-4026-a481-5148f8130911"],

Cell[BoxData["getTriangleC"], "Input",
 CellChangeTimes->{{3.882942744455398*^9, 
  3.882942749093054*^9}},ExpressionUUID->"5984e4c8-9ddd-4a9f-8274-\
508e28522918"],

Cell[BoxData["Circum"], "Input",
 CellChangeTimes->{{3.882942611394165*^9, 
  3.882942612768045*^9}},ExpressionUUID->"46d11d05-1553-4c59-adf1-\
b42b58363362"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"d", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PP", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Indexed", "[", 
      RowBox[{"P", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"dim", "+", "1"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tt", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Compile`GetElement", "[", 
      RowBox[{"t", ",", "i"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "dim"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UU", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"PP", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
      "-", 
      RowBox[{"PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "2", ",", 
       RowBox[{"dim", "+", "1"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", "=", 
   RowBox[{
    RowBox[{"PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+", 
    RowBox[{"tt", ".", "UU"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r2list", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Dot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"PP", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
        "-", "x"}], ",", 
       RowBox[{
        RowBox[{"PP", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
        "-", "x"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"dim", "+", "1"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eq", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
      "r2list", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "-", 
      RowBox[{
      "r2list", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "2", ",", 
       RowBox[{"dim", "+", "1"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ttopt", "=", 
   RowBox[{"tt", "/.", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"eq", "\[Equal]", 
        RowBox[{"0", "eq"}]}], ",", "tt"}], "]"}], "\[LeftDoubleBracket]", 
     "1", "\[RightDoubleBracket]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"circumcenter", "=", 
   RowBox[{
    RowBox[{"PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+", 
    RowBox[{"ttopt", ".", "UU"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"r", "=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"Total", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"ttopt", ".", "UU"}], ")"}], "^", "2"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"circumsphere", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"circumcenter", ",", 
     RowBox[{"{", "r", "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8829428189626083`*^9, 3.882942858263484*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"bbafeec8-7042-4762-b4eb-7232384611bb"],

Cell[BoxData["r"], "Input",
 CellChangeTimes->{3.882942826016082*^9},
 CellLabel->"In[43]:=",ExpressionUUID->"adf3aee3-949f-47c8-ba16-c7fab0e5cb92"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"d", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"x", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Y", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"y", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Z", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"z", "[", "i", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8829703518708277`*^9, 3.882970386612496*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"20467b3a-b357-43d1-b543-46da5a71fed8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"X", "=", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8829703748251333`*^9, 
  3.882970377851622*^9}},ExpressionUUID->"e770510a-1139-455e-b5d6-\
c688ec685428"],

Cell[BoxData[
 RowBox[{"f", "=", 
  RowBox[{"1", "/", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"Dot", "[", 
     RowBox[{"X", ",", "X"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8829703546279173`*^9, 3.882970364335671*^9}, {
  3.882970473502276*^9, 3.882970474950766*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"b5cbaee2-68bb-4f98-83fd-16b03239827c"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8829703935239153`*^9, 3.882970394241519*^9}, 
   3.882970481504959*^9},ExpressionUUID->"9f1f0cce-64b6-4007-90d3-\
4e00faffd8e5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"r", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"1", "/", "2"}], "/", "2"}], "/", "2"}], "/", "2"}], "/", 
      "2"}], "/", "2"}], "/", "2"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"NIntegrate", "[", 
  RowBox[{"f", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x", "[", "1", "]"}], ",", 
     RowBox[{"-", "r"}], ",", "r"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x", "[", "2", "]"}], ",", 
     RowBox[{"-", "r"}], ",", "r"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.882970368465013*^9, 3.882970407110125*^9}, {
  3.882970478983329*^9, 3.882970496423316*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"cf862c3c-c4d1-47a7-88f5-192794e5929d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"M", "=", 
   RowBox[{"TorusMesh", "[", 
    RowBox[{"3", ",", "1", ",", 
     RowBox[{"Mesh", "->", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"30", ",", "10"}], "}"}], "2", " ", "2", " ", "2"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Av", "=", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"TriangleAreas", "[", "M", "]"}], "/", "3"}], ")"}], "]"}], 
    RowBox[{"AdjacencyMatrix", "[", 
     RowBox[{"M", ",", "Triangles", ",", "Vertices"}], "]"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.883052677980567*^9, 3.883052678000475*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"a9851101-9b39-4532-ad6b-ebdec6150ed1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"R", "=", 
   RowBox[{"Repulsor", "[", "M", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"B", "=", 
  RowBox[{
   RowBox[{"BlockClusterMatrices", "[", "R", "]"}], "[", "\"\<Far\>\"", 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.883052672349494*^9, 3.883052684310663*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"fca933cf-aa9c-48a2-b4c0-c1cd7c5b62dc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "cMatrix", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cMatrix", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Nu]", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Kappa]", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ibegin", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"iend", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"jbegin", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"jend", ",", "_Integer"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n", ",", "u", ",", "x1", ",", "x2", ",", "x3", ",", "\[Nu]1", ",", 
         "\[Nu]2", ",", "\[Nu]3", ",", "w1", ",", "w2", ",", "w3", ",", "R", 
         ",", "R2", ",", "R3", ",", "\[Nu]w", ",", "ai", ",", "aj", ",", 
         "factor", ",", "A"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"A", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"0.", "+", 
            RowBox[{"0.", "I"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"iend", "-", "ibegin", "+", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"jend", "-", "jbegin", "+", "1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"x1", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"x", ",", "i", ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x2", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"x", ",", "i", ",", "2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x3", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"x", ",", "i", ",", "3"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"\[Nu]1", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"\[Nu]", ",", "i", ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"\[Nu]2", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"\[Nu]", ",", "i", ",", "2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"\[Nu]3", "=", 
            RowBox[{"Compile`GetElement", "[", 
             RowBox[{"\[Nu]", ",", "i", ",", "3"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"i", "!=", "j"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"w1", "=", 
                  RowBox[{
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "1"}], "]"}], "-", "x1"}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"w2", "=", 
                  RowBox[{
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "2"}], "]"}], "-", "x2"}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"w3", "=", 
                  RowBox[{
                   RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"x", ",", "j", ",", "3"}], "]"}], "-", "x3"}]}], 
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"R2", "=", 
                  RowBox[{
                   RowBox[{"w1", " ", "w1"}], "+", 
                   RowBox[{"w2", " ", "w2"}], "+", 
                   RowBox[{"w3", " ", "w3"}]}]}], ";", "\[IndentingNewLine]", 
                 
                 RowBox[{"R", "=", 
                  RowBox[{"Sqrt", "[", "R2", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"R3", "=", 
                  RowBox[{"R", " ", "R2"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"\[Nu]w", "=", 
                  RowBox[{
                   RowBox[{"\[Nu]1", " ", "w1"}], "+", 
                   RowBox[{"\[Nu]2", " ", "w2"}], "+", 
                   RowBox[{"\[Nu]3", " ", "w3"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"A", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "ibegin", "+", "1"}], ",", 
                    RowBox[{"j", "-", "jbegin", "+", "1"}]}], "]"}], "]"}], 
                  "=", 
                  RowBox[{"-", 
                   FractionBox[
                    RowBox[{" ", 
                    RowBox[{
                    SuperscriptBox["\[ExponentialE]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1.", "I"}], ")"}], " ", "R", " ", "\[Kappa]"}]], 
                    " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"0.5", "I"}], ")"}], "R2", " ", "\[Kappa]"}], "-",
                     " ", "\[Nu]w", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1.", "I"}], ")"}], " ", "R", " ", "\[Kappa]", 
                    " ", "\[Nu]w"}]}], ")"}]}]}], 
                    RowBox[{" ", "R3"}]]}]}], ";"}]}], "\[IndentingNewLine]", 
               "]"}], ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "jbegin", ",", "jend"}], "}"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ibegin", ",", "iend"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "A"}]}], "\[IndentingNewLine]", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"RuntimeAttributes", "->", 
      RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"Parallelization", "->", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.88305278405062*^9, 3.883052784471525*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"bb003e81-1a71-4a34-9a40-b4bfaaf6c467"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"i", ",", "j"}], "}"}], "=", 
   RowBox[{
    RowBox[{"B", "[", "\"\<NonzeroPositions\>\"", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.883052641330966*^9, 3.8830526622420893`*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"b3120072-9c2f-40ca-9dc6-85ee1ec76b8b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ibegin", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"ClusterBegin", "[", "R", "]"}], "[", 
     RowBox[{"[", "i", "]"}], "]"}], "+", "1"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"iend", "=", 
    RowBox[{
     RowBox[{"ClusterEnd", "[", "R", "]"}], "[", 
     RowBox[{"[", "i", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jbegin", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"ClusterBegin", "[", "R", "]"}], "[", 
     RowBox[{"[", "j", "]"}], "]"}], "+", "1"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jend", "=", 
   RowBox[{
    RowBox[{"ClusterEnd", "[", "R", "]"}], "[", 
    RowBox[{"[", "j", "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8830526635315857`*^9, 3.883052703629998*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"331105f9-deb2-47e5-8898-b0e31af49941"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"block", "=", 
    RowBox[{"cMatrix", "[", 
     RowBox[{
      RowBox[{"TriangleMidpoints", "[", "M", "]"}], ",", 
      RowBox[{"TriangleNormals", "[", "M", "]"}], ",", ".2", ",", "ibegin", 
      ",", "iend", ",", "jbegin", ",", "jend"}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.883052735641182*^9, 3.883052756150227*^9}, {
  3.883052913484139*^9, 3.883052913702574*^9}},
 CellLabel->
  "In[121]:=",ExpressionUUID->"eed2580b-fc29-4322-a323-25b3239768fc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"U", ",", "\[CapitalSigma]", ",", "V"}], "}"}], "=", 
    RowBox[{"SingularValueDecomposition", "[", "block", "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellLabel->
  "In[122]:=",ExpressionUUID->"5529c7e2-a7e4-48e0-85cf-2caed6b247ca"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Kappa]", "=", "0.2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"col", "[", "j_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"cMatrix", "[", 
     RowBox[{
      RowBox[{"TriangleMidpoints", "[", "M", "]"}], ",", 
      RowBox[{"TriangleNormals", "[", "M", "]"}], ",", "\[Kappa]", ",", 
      "ibegin", ",", "iend", ",", 
      RowBox[{"j", "+", "jbegin", "-", "1"}], ",", 
      RowBox[{"j", "+", "jbegin", "-", "1"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"row", "[", "i_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"cMatrix", "[", 
     RowBox[{
      RowBox[{"TriangleMidpoints", "[", "M", "]"}], ",", 
      RowBox[{"TriangleNormals", "[", "M", "]"}], ",", "\[Kappa]", ",", 
      RowBox[{"i", "+", "ibegin", "-", "1"}], ",", 
      RowBox[{"i", "+", "ibegin", "-", "1"}], ",", "jbegin", ",", "jend"}], 
     "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.883052993982524*^9, 3.8830530088164053`*^9}, {
  3.883053054946189*^9, 3.883053127231222*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"3c346b35-2f8b-4406-8531-749a0cdefbaf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"row", "[", "1", "]"}], "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.883053101293952*^9, 3.8830531114073153`*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"84b236e5-ebe5-4547-b2ef-c0d5fd9a940d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"col", "[", "jbegin", "]"}], "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.883053009887967*^9, 3.88305304626595*^9}, {
  3.883053115242996*^9, 3.8830531187410603`*^9}},
 CellLabel->
  "In[105]:=",ExpressionUUID->"bc0787d5-bbe7-4b12-a39c-5570abe56d6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"data", "=", 
    RowBox[{"ACACompression", "[", 
     RowBox[{"row", ",", "col"}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.883053130341405*^9, 3.883053137418256*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"f574e1c1-f8c1-4c0c-9c70-cfb2d2d55019"],

Cell[BoxData[
 RowBox[{"data", "//", "Dataset"}]], "Input",
 CellChangeTimes->{{3.883053308605489*^9, 3.883053312730624*^9}},
 CellLabel->
  "In[120]:=",ExpressionUUID->"d74b4ceb-b83a-49e2-872a-e3c9677f4795"],

Cell[BoxData[
 RowBox[{"?", "*`IAMAX"}]], "Input",
 CellChangeTimes->{{3.883053204420796*^9, 3.883053206296966*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"85429171-e526-4e4a-bfcd-794bdfba5fa6"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.883053210996065*^9, 3.8830532284790897`*^9}, {
   3.883053263117021*^9, 3.883053302057538*^9}, 
   3.8830533406456757`*^9},ExpressionUUID->"cc50fb9f-587a-4bba-b69a-\
69a64bd37162"],

Cell[BoxData[
 RowBox[{"block", "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.883052793022765*^9, 3.883052794003481*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"fa90e082-7e0c-4aae-9a56-9cb36efe4a97"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"U", ",", "\[CapitalSigma]", ",", "V"}], "}"}], "=", 
    RowBox[{"SingularValueDecomposition", "[", "block", "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rk", "=", 
   RowBox[{
    RowBox[{"FirstPosition", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Diagonal", "[", "\[CapitalSigma]", "]"}], "/", 
       RowBox[{"\[CapitalSigma]", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "<", 
          RowBox[{"10", "^", 
           RowBox[{"-", "4"}]}]}], "&"}], ")"}]}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.883052826862756*^9, 3.883052838179193*^9}, {
  3.8830528819313307`*^9, 3.883052904167403*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"cb8af097-ced3-4470-85f9-daeaa65a53b5"]
},
WindowSize->{1496, 905},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules-><|"TryRealOnly" -> False|>,
FrontEndVersion->"13.1 for Mac OS X ARM (64-bit) (June 16, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"825af9ab-c7ab-4ed8-8100-b719788f25aa"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 176, 2, 33, "Input",ExpressionUUID->"d18aecdd-81bd-4349-83a0-f7189101b864"],
Cell[737, 24, 504, 11, 55, "Input",ExpressionUUID->"586513da-5b14-4534-8da5-787999cc3862"],
Cell[1244, 37, 1295, 29, 97, "Input",ExpressionUUID->"8ad1c0ba-b02f-4aa8-9234-d4e7e73a665c"],
Cell[2542, 68, 2516, 75, 307, "Input",ExpressionUUID->"b1b61abe-9f95-4822-aca6-4adaaa0aa621"],
Cell[5061, 145, 16081, 357, 2087, "Input",ExpressionUUID->"65f2fcd9-a55f-422f-83e6-20a36b43e3f6"],
Cell[21145, 504, 152, 3, 33, "Input",ExpressionUUID->"e92b20b5-2d4e-4af3-8683-9503f046b4b6"],
Cell[21300, 509, 1332, 34, 97, "Input",ExpressionUUID->"2015d288-eb3f-4514-ade6-85d44128e3c6"],
Cell[22635, 545, 2546, 69, 265, "Input",ExpressionUUID->"b3045e1b-d1dc-4d10-8956-42da191eeb8d"],
Cell[25184, 616, 269, 5, 33, "Input",ExpressionUUID->"c2b91be5-d559-43c9-b8a3-5b5b0a79ee12"],
Cell[25456, 623, 410, 9, 34, "Input",ExpressionUUID->"7d1214ae-f644-42be-a28b-027072396081"],
Cell[25869, 634, 602, 15, 34, "Input",ExpressionUUID->"888592c0-4315-4aa3-9965-57749449b336"],
Cell[26474, 651, 162, 4, 34, "Input",ExpressionUUID->"341876ec-4665-4428-90f7-12b362c97e00"],
Cell[26639, 657, 286, 7, 33, "Input",ExpressionUUID->"e87525e6-6bfa-4af7-8c66-49e3c82cb9d6"],
Cell[26928, 666, 206, 4, 33, "Input",ExpressionUUID->"732ca52d-b8cc-421d-8f33-b8853a77d30f"],
Cell[27137, 672, 175, 3, 33, "Input",ExpressionUUID->"aac9108b-9491-46e5-89bb-84139eddd052"],
Cell[27315, 677, 205, 4, 33, "Input",ExpressionUUID->"02c3f2e2-054f-4a2c-bc16-7d1c2523bca0"],
Cell[27523, 683, 214, 4, 33, "Input",ExpressionUUID->"c3fefd57-557b-4d97-94b9-9c9b54d85897"],
Cell[27740, 689, 205, 4, 33, "Input",ExpressionUUID->"4bc9b89d-09ae-4910-83de-63f4328196b1"],
Cell[27948, 695, 179, 4, 33, "Input",ExpressionUUID->"8cf373c7-eda1-4f46-a020-e0029f896c99"],
Cell[28130, 701, 234, 5, 33, "Input",ExpressionUUID->"93b39c72-5cbc-4d0f-8ba2-5f8dacf10eee"],
Cell[28367, 708, 153, 3, 33, "Input",ExpressionUUID->"e4f9882f-020c-4bcf-8c3d-010174551656"],
Cell[28523, 713, 152, 3, 33, "Input",ExpressionUUID->"297e29b2-b67d-4e92-8acc-4520a42de636"],
Cell[28678, 718, 323, 8, 33, "Input",ExpressionUUID->"26ef3ba0-aec7-4e60-b032-b4689edb97f7"],
Cell[29004, 728, 212, 4, 33, "Input",ExpressionUUID->"4b738fbb-7b19-42f7-86fb-fc020b9463c0"],
Cell[29219, 734, 152, 3, 33, "Input",ExpressionUUID->"fbdc1b07-7ecd-4a1a-a491-909f727072dd"],
Cell[29374, 739, 549, 14, 34, "Input",ExpressionUUID->"7969a3fe-5b6a-4414-ad40-28a4d98cdc3b"],
Cell[29926, 755, 147, 3, 55, "Input",ExpressionUUID->"a3f08e1b-9962-4110-88e3-9ce434b49460"],
Cell[30076, 760, 206, 4, 33, "Input",ExpressionUUID->"2e0806c1-7b76-4ed4-9a3e-a2c05c8cc48e"],
Cell[30285, 766, 180, 3, 33, "Input",ExpressionUUID->"5742787d-f79c-4bd1-bd36-bd24b31493d9"],
Cell[30468, 771, 177, 3, 33, "Input",ExpressionUUID->"ce545b33-a26c-45db-8245-230aa6f2f510"],
Cell[30648, 776, 787, 17, 160, "Input",ExpressionUUID->"6b446738-454b-41ac-9bbb-881d3d378c75"],
Cell[31438, 795, 264, 6, 33, "Input",ExpressionUUID->"aed34bea-99fc-4ac7-919e-3f7cf9ca8cd4"],
Cell[31705, 803, 208, 4, 33, "Input",ExpressionUUID->"eeaf195d-57e0-4a63-8765-918bc7f81e1b"],
Cell[31916, 809, 152, 3, 33, "Input",ExpressionUUID->"048b9279-6a7a-4c54-8bc3-c258fbd05a38"],
Cell[32071, 814, 210, 4, 33, "Input",ExpressionUUID->"dd7c7267-a52a-4f00-a9b4-83f72bc13109"],
Cell[32284, 820, 2024, 63, 160, "Input",ExpressionUUID->"a5429363-d065-4be8-a815-da14298c6eb9"],
Cell[34311, 885, 476, 12, 34, "Input",ExpressionUUID->"4a141a1b-4e17-4ee3-a482-30be2ed09dce"],
Cell[34790, 899, 1431, 45, 40, "Input",ExpressionUUID->"12b88551-39f7-4c82-b083-0d131a33d8dc"],
Cell[36224, 946, 243, 5, 33, "Input",ExpressionUUID->"913cbdd3-a0c1-4001-a942-9eec51798f2e"],
Cell[36470, 953, 719, 19, 33, "Input",ExpressionUUID->"f465b36d-a39e-44eb-a249-a65f54a11a80"],
Cell[37192, 974, 154, 3, 33, "Input",ExpressionUUID->"00c41a40-e3f9-48fd-90da-8113bd7fb8e7"],
Cell[37349, 979, 401, 10, 33, "Input",ExpressionUUID->"ce0bd1d8-0d9c-4dde-8dfd-881556e5a12e"],
Cell[37753, 991, 1248, 31, 55, "Input",ExpressionUUID->"13775838-fd37-4db5-9e68-fecbcfb5322d"],
Cell[39004, 1024, 189, 3, 33, "Input",ExpressionUUID->"71aa9f40-2fe7-4098-8207-0c1e6a310273"],
Cell[39196, 1029, 687, 18, 34, "Input",ExpressionUUID->"8998f1ce-e3be-4e09-8d36-827b2f238999"],
Cell[39886, 1049, 406, 9, 33, "Input",ExpressionUUID->"df1aee22-db32-43f8-a1a6-8efc125284c8"],
Cell[40295, 1060, 129, 3, 33, "Input",ExpressionUUID->"f432e111-7395-4735-b9e5-416a60d93b37"],
Cell[40427, 1065, 292, 6, 34, "Input",ExpressionUUID->"0ea92abd-3d5d-4a8b-9cc7-705e87dcadf7"],
Cell[40722, 1073, 767, 21, 55, "Input",ExpressionUUID->"d11a9db6-0530-4b1f-80d4-48d56cfc2f40"],
Cell[41492, 1096, 1051, 33, 40, "Input",ExpressionUUID->"17a534f9-d0eb-4dac-88d4-47d6503d0f5c"],
Cell[42546, 1131, 3375, 102, 66, "Input",ExpressionUUID->"8e1bef29-128d-49da-b465-7f108240a535"],
Cell[45924, 1235, 221, 4, 33, "Input",ExpressionUUID->"b7ad19dc-7c31-4be3-bc25-c220fda24938"],
Cell[46148, 1241, 300, 4, 55, "Input",ExpressionUUID->"c7db2593-02b6-47da-84ed-94b51c7b4788"],
Cell[46451, 1247, 248, 5, 34, "Input",ExpressionUUID->"dc9ffd70-cd59-4e48-b87c-9d6ad383a893"],
Cell[46702, 1254, 308, 6, 34, "Input",ExpressionUUID->"d4fd69ef-a6c4-4424-aaf5-3c7991932366"],
Cell[47013, 1262, 519, 16, 34, "Input",ExpressionUUID->"d682aed4-5de6-4d86-9503-522979edb467"],
Cell[47535, 1280, 152, 3, 33, "Input",ExpressionUUID->"915affd5-6353-4c99-9310-107955f39b51"],
Cell[47690, 1285, 225, 5, 33, "Input",ExpressionUUID->"a9ba5d8e-6c24-4af7-8c86-15ca2b1050a9"],
Cell[47918, 1292, 179, 3, 33, "Input",ExpressionUUID->"2d63c2c2-b95d-4629-88a8-9447b393f345"],
Cell[48100, 1297, 914, 27, 55, "Input",ExpressionUUID->"95ad01ee-89f8-4123-a61f-06e8bf19795c"],
Cell[49017, 1326, 408, 11, 55, "Input",ExpressionUUID->"a505d88c-b129-4276-897f-45b1646ac738"],
Cell[49428, 1339, 214, 3, 33, "Input",ExpressionUUID->"28e530dc-140d-4b2e-859d-edaf4605de2b"],
Cell[49645, 1344, 226, 3, 34, "Input",ExpressionUUID->"42d6c0a0-36ca-45e0-a4e8-64b3edc1e9a3"],
Cell[49874, 1349, 228, 3, 34, "Input",ExpressionUUID->"7225198b-1689-4026-a481-5148f8130911"],
Cell[50105, 1354, 164, 3, 34, "Input",ExpressionUUID->"5984e4c8-9ddd-4a9f-8274-508e28522918"],
Cell[50272, 1359, 158, 3, 33, "Input",ExpressionUUID->"46d11d05-1553-4c59-adf1-b42b58363362"],
Cell[50433, 1364, 3318, 101, 244, "Input",ExpressionUUID->"bbafeec8-7042-4762-b4eb-7232384611bb"],
Cell[53754, 1467, 148, 2, 33, "Input",ExpressionUUID->"adf3aee3-949f-47c8-ba16-c7fab0e5cb92"],
Cell[53905, 1471, 882, 27, 97, "Input",ExpressionUUID->"20467b3a-b357-43d1-b543-46da5a71fed8"],
Cell[54790, 1500, 246, 7, 33, "Input",ExpressionUUID->"e770510a-1139-455e-b5d6-c688ec685428"],
Cell[55039, 1509, 358, 8, 34, "Input",ExpressionUUID->"b5cbaee2-68bb-4f98-83fd-16b03239827c"],
Cell[55400, 1519, 177, 3, 33, "Input",ExpressionUUID->"9f1f0cce-64b6-4007-90d3-4e00faffd8e5"],
Cell[55580, 1524, 778, 23, 55, "Input",ExpressionUUID->"cf862c3c-c4d1-47a7-88f5-192794e5929d"],
Cell[56361, 1549, 746, 21, 55, "Input",ExpressionUUID->"a9851101-9b39-4532-ad6b-ebdec6150ed1"],
Cell[57110, 1572, 413, 9, 76, "Input",ExpressionUUID->"fca933cf-aa9c-48a2-b4c0-c1cd7c5b62dc"],
Cell[57526, 1583, 6763, 153, 935, "Input",ExpressionUUID->"bb003e81-1a71-4a34-9a40-b4bfaaf6c467"],
Cell[64292, 1738, 370, 9, 34, "Input",ExpressionUUID->"b3120072-9c2f-40ca-9dc6-85ee1ec76b8b"],
Cell[64665, 1749, 915, 28, 118, "Input",ExpressionUUID->"331105f9-deb2-47e5-8898-b0e31af49941"],
Cell[65583, 1779, 540, 13, 34, "Input",ExpressionUUID->"eed2580b-fc29-4322-a323-25b3239768fc"],
Cell[66126, 1794, 325, 9, 34, "Input",ExpressionUUID->"5529c7e2-a7e4-48e0-85cf-2caed6b247ca"],
Cell[66454, 1805, 1176, 29, 76, "Input",ExpressionUUID->"3c346b35-2f8b-4406-8531-749a0cdefbaf"],
Cell[67633, 1836, 240, 5, 33, "Input",ExpressionUUID->"84b236e5-ebe5-4547-b2ef-c0d5fd9a940d"],
Cell[67876, 1843, 293, 6, 34, "Input",ExpressionUUID->"bc0787d5-bbe7-4b12-a39c-5570abe56d6d"],
Cell[68172, 1851, 333, 9, 34, "Input",ExpressionUUID->"f574e1c1-f8c1-4c0c-9c70-cfb2d2d55019"],
Cell[68508, 1862, 208, 4, 33, "Input",ExpressionUUID->"d74b4ceb-b83a-49e2-872a-e3c9677f4795"],
Cell[68719, 1868, 199, 4, 33, "Input",ExpressionUUID->"85429171-e526-4e4a-bfcd-794bdfba5fa6"],
Cell[68921, 1874, 229, 4, 33, "Input",ExpressionUUID->"cc50fb9f-587a-4bba-b69a-69a64bd37162"],
Cell[69153, 1880, 208, 3, 33, "Input",ExpressionUUID->"fa90e082-7e0c-4aae-9a56-9cb36efe4a97"],
Cell[69364, 1885, 986, 27, 55, "Input",ExpressionUUID->"cb8af097-ced3-4470-85f9-daeaa65a53b5"]
}
]
*)

